name: Code Quality Checks

# This workflow runs optional code quality checks
# It won't block merges but provides helpful feedback

on:
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:  # Allow manual trigger

jobs:
  python-quality:
    name: Python Code Quality
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v6
      with:
        python-version: '3.11'
        cache: 'pip'

    - name: Install linting tools
      run: |
        python -m pip install --upgrade pip
        pip install black flake8 pylint isort

    - name: Check code formatting with Black
      run: |
        echo "üé® Checking Python code formatting..."
        black --check --diff backend/ --exclude='backend/models_cache/' || {
          echo "‚ö†Ô∏è  Code formatting issues found. Run: black backend/"
          exit 0  # Don't fail, just warn
        }
      continue-on-error: true

    - name: Check import sorting with isort
      run: |
        echo "üì¶ Checking import order..."
        isort --check-only --diff backend/ || {
          echo "‚ö†Ô∏è  Import sorting issues found. Run: isort backend/"
          exit 0
        }
      continue-on-error: true

    - name: Lint with Flake8
      run: |
        echo "üîç Running Flake8 linter..."
        flake8 backend/ --exclude=backend/models_cache/,backend/__pycache__/ --statistics || {
          echo "‚ö†Ô∏è  Linting issues found"
          exit 0
        }
      continue-on-error: true

    - name: Analyze with Pylint
      run: |
        echo "üî¨ Running Pylint analysis..."
        pylint backend/ --recursive=y --ignore=models_cache,__pycache__ --exit-zero || {
          echo "‚ö†Ô∏è  Pylint found some issues"
          exit 0
        }
      continue-on-error: true

  javascript-quality:
    name: JavaScript Code Quality
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json

    - name: Install dependencies
      working-directory: ./frontend
      run: npm ci

    - name: Run ESLint
      working-directory: ./frontend
      run: |
        echo "üîç Running ESLint..."
        npm run lint || {
          echo "‚ö†Ô∏è  ESLint found some issues"
          exit 0
        }
      continue-on-error: true

  summary:
    name: Quality Check Summary
    runs-on: ubuntu-latest
    needs: [python-quality, javascript-quality]
    if: always()
    
    steps:
    - name: Summary
      run: |
        echo "üìä Code Quality Check Complete"
        echo ""
        echo "These are optional checks to help improve code quality."
        echo "They won't block your PR from being merged."
        echo ""
        echo "To fix formatting issues locally:"
        echo "  Python: black backend/"
        echo "  Python imports: isort backend/"
        echo "  JavaScript: cd frontend && npm run lint -- --fix"

